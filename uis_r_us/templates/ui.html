{% extends "ui_base.html" %}
{% block head %}
<style type="text/css" media="screen">
	#image-nav {
		display: none;
		padding: 3px 20px;
		height: 150px;
	}
	#image-nav .image-iwrap {
		width: 100%;
		overflow: auto;
		height: 130px;
	}
	#image-nav ul {
		width: 999em;
	}
	#image-nav li {
		list-style-type: none;
		margin-right: 8px;
	}
	.img-wrap {
		background-color: #666;
		width: 100px;
		height: 100px;
		border: 1px solid black;
		float: left;
	}
	#column-description {
		padding: 20px 10px;
		background-color: rgba(0,0,0,0.1);
		margin-top: 20px;
	}
	.column-data-wrap {}
	.column-data {
		margin: 4px 12px;
		color: #fff;
		background-color: rgba(0,0,0,0.5);
		border: 0 none;
		border-radius: 3px;
	}
	.col-info {
		margin: 2px 5px;
	}
	.col-info h2 {
		margin: 2px 0;
	}
	.col-info h3.description {
		margin: 2px 0;
		text-decoration: underline;
	}
	.sn-wrap {
		position: absolute;
		top: 200px;
		left: 0;
		z-index: 99;
	}
	.sn {
		margin: 3px 7px;
		background-color: #fff;
		width: 185px;
		padding: 6px 3px;
	}
	.sn ul {
		margin: 0;
		padding-left: 20px;
	}
	.sn ul ul {
		padding-left: 10px;
	}
	#facility-tabs.hide-tds td, #facility-tabs.hide-tds th {
		display: none;
	}
	#facility-tabs.hide-tds .show-me {
		display: table-cell;
	}
	
	/*--
	Right display div for facility popup
	--*/
	.rd-wrap {
		height: 65%;
		right: 0;
		position: absolute;
		z-index: 99
	}
	.right-div {
		background-color: #fff;
		margin: 4px 5px 5px 0;
	}
	.sub-sector-list a {
		padding: 3px 8px;
/*		text-decoration: none;
		border: 1px solid #999;
		color: #444;
		background-color: #eee;
		padding: 2px 6px;
		border-radius: 3px; */
	}
	.sub-sector-list a:hover {
		background-color: #ddd;
	}
	.sub-sector-list a.selected {
		background-color: #ccc;
	}
	.profile-data-wrap {
		position: absolute;
		top: 0;
		left: 50px;
		z-index: 15;
	}
	.profile-data {
		padding: 4px;
		margin: 5px 12px;
		background-color: rgba(255,255,255,0.9);
		height: 175px;
		overflow: auto;
	}
	.profile-data h2 {
		margin: 3px 0;
	}
	.profile-data h3 {
		margin: 2px 0;
	}
    .profile-data.hidden {
        display: none;
    }
	#header .toggle-button {
		color: #eee;
		text-decoration: none;
		padding: 4px 13px;
		font-size: 13px;
		opacity: 0.8;
	}
	div.toggleable {
		display: block;
	}
	div.toggleable.hidden {
		display: none;
	}
	#header .toggle-button.toggled {
		opacity: 1;
	}
	#lga-facilities-table.hidden {
		display: none;
	}
</style>
<link rel="stylesheet" href="/static/openlayers/default/style.css" type="text/css" media="all" charset="utf-8">
{% endblock %}
{% block content %}
<div class='content-inner-wrap'>
	<div class="widget-outer-wrap" style="bottom:0">
		<div class="fullw-widget">
			<div id="lga-facilities-table"></div>
		</div>
	</div>
	<div id="map" class="resizing-map"></div>
</div>
<div id="gap-analysis-table-template" style="display:none">
	<table>
		<tbody>
			<tr>
				<td></td>
				<td></td>
				<td>Current</td>
				<td>Target</td>
				<td>Gap</td>
			</tr>
			<tr>
				<td rowspan="3">
					Facilities Per Population
				</td>
				<td>
					Insitutional Delivery
				</td>
				<td class="fill-me" data-variable-slug="num_health_facilities_institutional_delivery_only"></td>
				<td class="fill-me" data-variable-slug="target_health_facilities_institutional_delivery_only"></td>
				<td class="fill-me" data-variable-slug="gap_health_facilities_institutional_delivery_only"></td>
			</tr>
			<tr>
				<td>
					Basic EmOC
				</td>
				<td class="fill-me" data-variable-slug="num_health_facilities_basic_emoc_fully_functional"></td>
				<td class="fill-me" data-variable-slug="target_health_facilities_basic_emoc"></td>
				<td class="fill-me" data-variable-slug="gap_health_facilities_basic_emoc"></td>
			</tr>
			<tr>
				<td>
					Comprehensive EmOC
				</td>
				<td class="fill-me" data-variable-slug="num_health_facilities_comprehensive_emoc_fully_functional"></td>
				<td class="fill-me" data-variable-slug="target_health_facilities_comprehensive_emoc"></td>
				<td class="fill-me" data-variable-slug="gap_health_facilities_comprehensive_emoc"></td>
			</tr>
		</tbody>
		<tbody>
			<tr>
				<td></td>
				<td></td>
				<td>Current</td>
				<td>Target</td>
				<td>Gap</td>
			</tr>
			<tr>
				<td rowspan="5">
					Infrastructure
				</td>
				<td>
					Emergency Transport
				</td>
				<td class="fill-me" data-variable-slug="num_health_facilities_with_functioning_emergency_transport"></td>
				<td class="fill-me" data-variable-slug="num_primary_health_facilities"></td>
				<td class="fill-me" data-variable-slug="gap_health_facilities_emergency_transport"></td>
			</tr>	
			<tr>
				<td>
					Mobile Communications
				</td>
				<td class="fill-me" data-variable-slug="num_health_facilities_functioning_mobile_and_coverage"></td>
				<td class="fill-me" data-variable-slug="num_primary_health_facilities"></td>
				<td class="fill-me" data-variable-slug="gap_health_facilities_functioning_mobile_communications"></td>
			</tr>
			<tr>
				<td>
					Improved Water
				</td>
				<td class="fill-me" data-variable-slug="num_health_facilities_potable_water_past_mth"></td>
				<td class="fill-me" data-variable-slug="num_primary_health_facilities"></td>
				<td class="fill-me" data-variable-slug="gap_health_facilities_potable_water"></td>
			</tr>
			<tr>
				<td>
					Improved Sanitation
				</td>
				<td class="fill-me" data-variable-slug="num_health_facilities_with_functioning_improved_sanitation"></td>
				<td class="fill-me" data-variable-slug="num_primary_health_facilities"></td>
				<td class="fill-me" data-variable-slug="gap_health_facilities_functioning_improved_sanitation"></td>
			</tr>
			<tr>
				<td>
					Power
				</td>
				<td class="fill-me" data-variable-slug="num_health_facilities_power_access_and_functional"></td>
				<td class="fill-me" data-variable-slug="num_primary_health_facilities"></td>
				<td class="fill-me" data-variable-slug="gap_health_facilities_power_access_and_funtional"></td>
			</tr>
		</tbody>
	</table>
</div>
{% endblock %}
{% block js %}
<script src="/static/js/application.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/launch-open-layers.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
<!--

var debugMode = false;

var pageRootUrl = "/~";

var defaultSectorSlug = 'health';

var loadMap = true;
//var loadMap = $("input#load-map").attr('checked');

-->
</script>
<script src="/static/js/lga-dashboard.js?x23" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
<!--

$('.content-inner-wrap').css({'padding':0});
$(function(){
	var dashboard = $.sammy(function(){
		function createTitleForLga(state, lga) {
			return $("<span />").text("NMIS: ")
				.append($("<span />", {'class': 'state-name'}).text(state))
				.append($("<span />").text(' - '))
				.append($("<span />", {'class': 'lga-name'}).text(lga));
		}
		
		this.get(pageRootUrl, function(){
			setTitle($("<span />", {'text': 'NMIS'}));
			launchOpenLayers({
				defaultLayer: '',
				layers: [
				    ["Nigeria", "nigeria_base"],
				    ["Nigeria health workers per thousand people", "nigeria_healthworkers_per_thousand"],
				    ["Nigeria Health Facilities with Institutional Deliveries", "pct_healthfacilities_with_institutional_delivery"],
				    ["Nigeria No Stockouts of Bednets or Malaria Medicine", "nigeria_pct_no_bednet_malmeds_oneweek"],
				    ["Nigeria Classrooms That Need Repair", "nigeria_pct_classroom_need_repair"],
				    ["Nigeria classrooms with proportion student to teacher ratio > 40", "nigeria_prop_ratio_greater_than_40"],
				    ["Nigeria Immunization Rate", "nigearia_immunization_rate"],
				    ["Nigeria Under 5 Mortality Rate", "nigeria_under5_mortality_rate"],
				    ["Nigeria Child Wasting", "nigeria_wasting"],
				    ["Nigeria Child Health", "nigeria_child_health"],
				    ["Nigeria Child Nutrition", "nigeria_child_nutrition"],
				    ["Nigeria Maternal Health", "nigeria_maternal_health"],
				    ["Nigeria Primary Education Enrollment", "nigeria_primary_education_enrollment"]
		        ]
			});
		});
		
		function addToggleLinks(){
			var profileDataLink = $('<a />', {'href':'#'})
					.addClass('toggle-button')
					.text('[LGA]')
					.click(function(e){
						$('.profile-data').toggleClass('hidden')
						profileDataLink.toggleClass('hidden');
						return false;
					});
			var facilityTableLink = $('<a />', {'href':'#'})
					.addClass('toggle-button')
					.text('[FACILITIES]')
					.click(function(e){
						$('#lga-facilities-table').toggleClass('hidden');
						facilityTableLink.toggleClass('hidden');
						return false;
					});
			var gapAnalysisLink = $('<a />', {href: '#'})
					.addClass('toggle-button')
					.text('[GAP ANALYSIS]')
					.click(function(e){
						$('.gap-analysis-table-wrap')
							.addClass('toggleable')
							.toggleClass('hidden');
						gapAnalysisLink.toggleClass('hidden');
						return false;
					});
			$('#header .title')
					.append(profileDataLink)
					.append(gapAnalysisLink)
					.append(facilityTableLink)
		}
		this.get(pageRootUrl + ":lga/(.+)", function(){
			var lgaId = this.params.lga;
			this.params.splat.length !== 1 && warn("Sammy needs some help selecting a sector.");
			var fullSectorId = this.params.splat[0];
			lga.loadData(lgaId,
							function(){
								this.buildTable = true;
								var t = createTitleForLga(this.stateName, this.lgaName);
								setTitle(t);
								this.trigger('select-sector', {
									fullSectorId: fullSectorId
								});
								addToggleLinks();
							});
		})
		this.get(pageRootUrl + ":lga", function(){
			var lgaId = this.params.lga;
			lga.loadData(lgaId,
							function(){
								this.buildTable = true;
								var t = createTitleForLga(this.stateName, this.lgaName);
								setTitle(t);
								addToggleLinks();
							});
		});
	});
	
	window._dashboard = dashboard;
	dashboard.run();
});

// SetResizer is defiend in application.js
//   its purpose is to trigger "full-height" whenever the page is resized.
//   it has some weird side-effects on mobile browsers.
SetResizer(jQuery, ".content-inner-wrap", "#header, #menu", 15);

-->
</script>
{% endblock %}
