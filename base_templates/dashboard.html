<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Baseline Data Collection : {% block title %}{% endblock %}</title>
	<script type="text/javascript" src="/site-media/js/jquery-1.4.4-min.js"></script>
	<script type="text/javascript" src="/site-media/jquery-ui/jquery-ui-1.8.7.custom.min.js"></script>
	<script type="text/javascript" src="/site-media/js/jquery.buildin.js"></script>
	<script type="text/javascript" src="/site-media/js/jquery.tmpl.min.js"></script>
	<script type="text/javascript" src="/site-media/js/sammy-latest.min.js"></script>
	<script type="text/javascript" src="/site-media/js/sammy.extensions.js"></script>
	<script type="text/javascript" src="/site-media/js/nmis.dashboard.sammy.js"></script>
	<link rel="stylesheet" href="/site-media/css/sitewide.css" type="text/css" media="all" title="Sitewide" charset="utf-8" />
	<link rel="stylesheet" href="/site-media/css/map-key.css" type="text/css" media="all" title="Sitewide" charset="utf-8" />
	<link rel="stylesheet" href="/site-media/css/tables.css" type="text/css" media="all" title="Sitewide" charset="utf-8" />
	<link rel="stylesheet" href="/site-media/css/generated-donotedit.css" type="text/css" media="all" title="Sitewide" charset="utf-8" />
	<link rel="stylesheet" href="/site-media/jquery-ui/jquery-ui-1.8.7.custom.css" type="text/css" media="screen" title="Sitewide" charset="utf-8" />
	<style type="text/css" media="screen">
		table.fullw {
			width: 100%;
		}
		.table-spacer {
			height: 16px;
			width:1px;
			border-left: 1px dotted #888;
		}
	</style>
</head>
<body class="nmis">
	<div id="header">
		<div class="fwidth">
			<a href="/#/" id="hlogo"><img src="/site-media/images/nmis_pilot.png" /></a>
			<h2 class="title">Baseline Data Collection &raquo; <span id="page-title">Dashboard</span></h2>
		<div class="account_links">
			<a href="/admin">Admin</a>
		</div>
		</div>
	</div>
	<ul id="menu">
		<div class="fwidth">
		</div>
	</ul>
	<div id="content">
		<div class="fwidth">
			<div class="full-content sliding" id="main">
				<div class="iwrap" id="dashboard">
					<div class="iiwrap">
					<p>Dashboard</p>
					<ul>
					</ul>
					<ul class="dashboard_stats"></ul>
					</div>
				</div>
				<div class="iwrap" id="activity">
					<div class="iiwrap">
						{% include '_activity.html' %}
					</div>
				</div>
				<div class="iwrap" id="frequency-tables">
					<div class="iiwrap">
						{% include '_frequency_table.html' %}
					</div>
				</div>
				<div class="iwrap" id="map">
					<div class="iiwrap">
						{% include '_map.html' %}
					</div>
				</div>
				<div style="display:none" class="mapkey">
					<a href="#" class="dontChangePage loadDistricts">Load LGA District Files</a>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript" charset="utf-8">
	$('body').delegate('.dontChangePage', 'click', function(evt){
		evt.preventDefault();
	})
	dashboard.activateSwitchTo(".full-content.sliding");

	var DashboardDebug = (function(){
		return {
			listInfo: function(list){
				var li = $("<li />").html("There are "+list.length+" entries.")
				$('.dashboard_stats').append(li)
			}
		}
	})()
	
	var ActivityList, ActivityPoint;
	(function($){
		function _ActivityList(arr){
			this.addPoints(arr)
		}
		_ActivityList.prototype = new Array();
		$.extend(_ActivityList.prototype, {
			addPoint: function(point){
				if(point instanceof _ActivityPoint) { this.push(point)
				} else {
					this.push(new _ActivityPoint(point))
				}
			},
			addPoints: function(points){
				var _Sl = this;
				$(points).each(function(){_Sl.addPoint(this)})
				DashboardDebug.listInfo(this);
			}
		})

		function _ActivityPoint(o){$.extend(this, o)}
		window.ActivityList = _ActivityList;
	})(jQuery);
	
//		var ActivityStorage = (function(){
			var storage = new Sammy.Store({name:'activity',element:'#content',type:'local'});
			var _stamp = false;
			
			var _list;
			
			function fetchActivity(stamp){
				var stamp = (typeof(stamp)=='undefined') ? "" : stamp;
							 
				var url = "/data/activity/"+stamp;
				$.getJSON(url, function(data){
					storage.set('activity', data);
					storage.set('activity_stamp', [data.stamp]);
					_list = new ActivityList(data.data);
					$('#main').trigger('activity-data-load');
				});
			}
			var clearStorageLink = $("<a />", {href:'#'}).html("Clear Storage");
			clearStorageLink.click(function(evt){
				storage.clear('activity');
				storage.clear('activity_stamp');
				evt.preventDefault();
			})
			$('.account_links').append(clearStorageLink)
			if(!storage.exists('activity')) {
				fetchActivity();
			} else {
				$('#main').trigger('activity-data-load');
				storage.get('activity')
			}
//		})()
		$('.button').button();
		SetResizer(jQuery, ".iiwrap", "#header, #menu", (16+24))
	</script>
</body>
</html>
