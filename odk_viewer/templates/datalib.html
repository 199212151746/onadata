{% extends 'base.html' %}
{% load i18n %}

{% block additional-headers %}
    <script src="/static/js/underscore-min.js" type="text/javascript"></script>
    <script src="/static/js/dv.js" type="text/javascript"></script>
    <script type="text/javascript" charset="utf-8" src="/static/js/datalib.js"></script>
{% endblock %}

{% block content %}
<script type="text/javascript">
    var formJSONUrl = "{% url odk_logger.views.download_jsonform username id_string %}";
    var mongoAPIUrl = "{% url main.views.api username id_string %}";
    var reader, schemaLoader, schemaManager, dataLoader, dataManager;
    var schemaPromise, dataPromise;

    reader = new Reader();

    schemaManager = new SchemaManager();
    schemaLoader = new AjaxLoader(reader, formJSONUrl);
    schemaPromise = schemaManager.init(schemaLoader);

    schemaPromise.done(function(){
        console.log("----------------Loaded schema--------------------");
        // load data
        dataManager = new DataManager(schemaManager);
        dataLoader = new AjaxLoader(reader, mongoAPIUrl);
        dataPromise = dataManager.init(dataLoader);

        dataPromise.done(function(){
            console.log("----------------Loaded data--------------------");
        });
    });

    (function($) {

    })(jQuery);
</script>
{% endblock %}